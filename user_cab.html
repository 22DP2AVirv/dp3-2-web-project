<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicīnas centrs</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/awesome/css/fontawesome.min.css" rel="stylesheet">
    <link href="/assets/awesome/css/brands.min.css" rel="stylesheet">
    <link href="/assets/awesome/css/solid.css" rel="stylesheet"> 
</head>
<style>
    .container-md h1{
        text-align: center;
    }

    .mb-3 {
        width: 550px;
        text-align: center;
        margin-right: auto;
        margin-left: auto;
    }
</style>
<header>
    <div class="container-md">
        <div class="navbar">
            <span class="logo-link" onclick="window.location.href='index.html';">
                <img src="/images/medicina.webp" alt="Medicīnas centra logo" class="logo">
            </span>
            <div class="dark-mode-toggle">
                <button id="registracija" onclick="window.location.href='index.html'">Iziet</button>
                <button id="dark-mode-btn">Tumsas režīms</button>        
            </div>
            <div class="menu">
                <li class="nav-item">
                    <a href="index.html"><i class="fa-solid fa-house"></i>Sākums </a>
                </li>
                <li>
                    <a href="parmums.html"><i class="fas fa-info-circle"></i>Par mums </a>
                </li>
                    <div class="dropdown">
                        <a href="#"><i class="fas fa-caret-down"></i>Izvēlne </a>
                    <div class="dropdown-content">
                        <li class="nav-item">
                            <a class="nav-link" href="cenas.html">Cenas</a>
                        </li>
                        <a href="pakalpojumi.html">Pakalpojumi</a>
                    </div>
                </div>
                <li>
                    <a href="kontakti.html"><i class="fas fa-envelope"></i>Kontakti </a>
                </li>
            </div>
            <div class="hamburger" onclick="toggleMenu()">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </div>
</header>
<body>
<div class="container-md">
    <h1 id="welcome">Sveiki!</h1>
    <div class="mb-3">
        <label class="form-label">Pašreizējā parole:</label>
        <input type="text" id="currentPassword" readonly class="form-control">
    </div>
    <div class="mb-3">
        <label class="form-label">Jaunā parole:</label>
        <input type="password" id="newPassword" class="form-control">
    </div>
    <div class="mb-3">
        <label class="form-label">Apstiprināt paroli:</label>
        <input type="password" id="confirmPassword" class="form-control">
    </div>
    <button id="savePassword" class="btn btn-primary">Saglabāt jauno paroli</button>
</div>
    <footer class="footer">
        <div class="container-md">
            <div class="row footer-row">
                <div class="col-md-4 left-column">
                    <div>
                        <h3>Health and Care</h3>
                        <p>Kontakti: +371 22351340</p>
                        <p>Adrese: Lidoņu iela 13, Rīga, LV-1055</p>
                    </div>
                </div>
                <div id="footerMenu" class="col-md-4 text-center">
                    <button class="work-time" onclick="showWorkTime()">Darba laiks</button>
                    <a href="index.html">
                        <button class="home">Sākums</button>
                    </a>
                    <a href="parmums.html">
                        <button class="about">Par mums</button>
                    </a>
                    <a href="kontakti.html">
                        <button class="contacts">Kontakti</button>
                    </a>
                    <div class="social-icons">
                        <a href=""><i class="fab fa-facebook"></i></a>
                        <a href=""><i class="fab fa-instagram"></i></a>
                        <a href=""><i class="fab fa-twitter"></i></a>
                    </div>
                    <p>&copy; 2024 Aleksis Virvinskis. Visas tiesības aizsargātas.</p>
                </div>
                <div id="rightFooterMenu" class="col-md-4 right-column">
                    <a href="pakalpojumi.html">
                        <button class="pakalpojumi">Pakalpojumi</button>
                    </a>
                    <a href="cenas.html">
                        <button class="price">Cenas</button>
                    </a>
                    <a href="privatuma-politika.html">
                    <button class="privacy">Privātuma politika</button>
                    </a>
                    <a href="registracija.html">
                        <button class="Logins">Log in / Sign up</button>
                    </a>
                </div>
            </div>
        </div>
    </footer>
    <div id="workTimeModal" class="work-time-modal">
        <div class="modal-content">
            <span class="close" onclick="closeWorkTime()">&times;</span>
            <h2>Darba laiks</h2>
            <p>Pirmdiena - Piektdiena: 9:00 - 21:00</p>
            <p>Sestdiena: 10:00 - 20:00</p>
            <p>Svētdiena: Slēgts</p>
        </div>
    </div>

    <script src="/assets/js/script.js"></script>
    <script src="/assets/js/scroll.js"></script>
    <script src="/assets/js/user_cab.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const name = params.get('name');
        if (name) {
            document.getElementById('welcome').textContent = `Sveiki, ${name}!`;
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const email = params.get('email');
                const response = await fetch('api/me', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json',
                                'x-email': email
                    }
                });
        
                if (!response.ok) throw new Error('Neizdevās ielādēt datus');
        
                const data = await response.json();
        
                // Parāda lietotājvārdu un paroli
                
                document.getElementById('currentPassword').value = data.password;

                // Klikšķis uz "Saglabāt jauno paroli"
                document.getElementById('savePassword').addEventListener('click', async () => {
                    const newPass = document.getElementById('newPassword').value;
                    const confirmPass = document.getElementById('confirmPassword').value;

                    if (newPass !== confirmPass) return alert('Paroles nesakrīt');

                    const updateRes = await fetch('api/update-password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password: newPass })
                    });

                    if (updateRes.ok) {
                        alert('Parole veiksmīgi atjaunināta!');
                    } else {
                        const err = await updateRes.text();
                        alert('Kļūda: ' + err);
                    }
            });

            }   catch (err) {
                console.error(err);
                alert('Kļūda ielādējot lietotāju');
            }
        });
        </script>    
    
</body>
</html>
